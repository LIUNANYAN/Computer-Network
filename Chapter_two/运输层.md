# 运输层  
## 目录
- ## <a href="#1">物理层的基本概念</a>
- ## <a href="#2">物理层下面的传输媒体</a>
- ## <a href="#3">传输方式</a>
- ## <a href="#4">编码与调制</a>
- ## <a href="#5">信道的极限容量</a>

## <a name="1">物理层的基本概念</a>
- 物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输比特流。
- 物理层为数据链路层屏蔽了各种传输媒体的差异，使数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体是什么。  
![p2_gai_nian_1]()  

物理层协议的主要任务：  
机械特性：指明接口所用接线器的**形状**和**尺寸**、**引脚数目**和**排列**、**固定**和**锁定位置**  
电气特性：指明在接口电缆的各条线上出现的**电压的范围**  
功能特性：指明某条线上出现的某一电平的**电压表示何种意义**  
过程特性：指明对于不同功能的各种可能**事件的出现顺序**  
![p2_gai_nian_2]()

由于在实际生活中，传输媒体的形式多种多样，所以我们在学习运输层时，不应局限于学习某种传输媒体的具体协议，而应把握各个协议的相同之处。  

## <a name="2">物理层下面的传输媒体</a>  
**注意：**传输媒体不属于计算机网络体系结构中的任何一层，如果非要将其纳入到计算机网络体系结构中，那么它应该位于物理层之下  

### 传输媒体分为两类：
- 导引型传输媒体：电磁波被导引沿着固体传播
   - 常见的导引型传输媒体有：同轴电缆、双绞线、光纤、电力线
 - 非导引型传输媒体：电磁波在自由空间中传播
   - 常见的非导引型传输媒体有：无线电波、微波、红外线、可见光  

### 导引型传输媒体：
**同轴电缆**  
这是一张同轴电缆的示意图：
![p2_mei_ti_1]()    
同轴电缆由**内导体、绝缘层、屏蔽层、绝缘保护套层**组成，每个层次中心同轴，故名同轴电缆  

同轴电缆有两种：
- 基带同轴电缆(50欧姆)：数字传输，过去常常用于局域网
- 宽带同轴电缆(75欧姆)：模拟传输，目前主要用于有线电视  

**同轴电缆价格较贵且布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体**  

**双绞线**  
双绞线是最古老又最常用的传输媒体，把两根互相绝缘的铜导线并排放在一起，然后按照一定规则绞合起来就构成了双绞线  
绞合的作用：
- 抵御部分来自外界的电磁干扰  
- 减少相邻导线的电磁干扰  
这是一张双绞线的示意图：  
![p2_mei_ti_2]()  
屏蔽双绞线比无屏蔽双绞线多了一层由金属细丝构成的屏蔽层  
下面是常见的双绞线及其典型应用：    
![p2_mei_ti_4]()  

**光纤**  
下面是光纤的结构图：  
![p2_mei_ti_3]()  
由于光纤非常细，所以必须把它做成很结实的光缆，一条光缆，少则有1条光纤，多则可包括数十至数百根光纤，再加上加强芯和填充物就可以大大提高机械强度，必要时还可放入远供电源线，最后加上包带层和外护套，就可以使抗拉强度达到几千克，能够满足施工要求。  

光纤的纤芯直径有
- 多模光纤：50微米，62.5微米  
- 单模光纤：9微米
电缆的包层直径为125微米  

光缆常用的三个波段中心为：  
- 0.85微米(衰减较大)  
- 1.30微米(衰减较小)
- 1.55微米(衰减较小)

光纤的优点：  
- 通信容量大(25000~30000Hz的宽带)
- 传输损耗小，远距离传输时更加经济  
- 抗雷电和电磁干扰性能好，这在大电流脉冲干扰的环境下尤为重要
- 无串音干扰，保密性好，不易被窃听
- 体积小，重量轻

光纤的缺点：  
- 割接需要专用设备
- 光电接口价格昂贵

接下来我们来看看光在光纤中传输的基本原理  
！[p2_mei_ti_5]()  
在发送端，可以用发光二极管半导体激光器作为光源，在接收端，可以用发电二极管激光检波器进行接收。  

当光从**高折射率**的媒体射向**低折射率**的媒体时，其**折射角将大于入射角**  
因此，如果**入射角足够大**，就会出现**全反射**，即光碰到包层时，就会反射回纤芯。  

实际上，只要从纤芯中射到纤芯表面的光线的入射角大于某一个临界角度，就可产生全放射，因此，可以存在许多条不同角度入射的光线在一条光纤中传输，这种光纤称为多模光纤。  
![p2_mei_ti_6]()  
若光纤的直径减小到只有一个光的波长，则光纤就像一根波导一样，它可使得光线一直向前传播，不会产生放射，这种光纤称为单模光纤。  

多模光纤：
- 由于色散，光在多模光纤中传输一定距离后必然产生信号失真(**脉冲展宽**)  
- 因此，多模光纤只适合**近距离传输**(建筑物内)  
- 发送光源：发光二极管；接收检测：光电二极管  

单模光纤：
- **没有模式色散**，在1.31微米波长附近材料色散和波导色散大小相等符号相反，两者正好抵消。
- 单模光纤适合**长距离传输**且衰减小，但其制造成本高，对光源要求高
- 发送光源：激光发生器；接收检测在；激光检波器  

**电力线**  
这是电力线传输方式的示意图：  
![p2_mei_ti_7]()  
电力线传输技术早在20世纪20年代就出现了，应用电力线传输信号的实例最早是电力线电话，目前，如果要构建家庭高性能局域网，采用电力线作为传输媒体是不能满足要求的，对于装修时没有进行网络布线的家庭，可以采用这种方式，对于一些拥有独立办公室的企业来说，每间办公室的电脑数量不多，而又不希望进行跨办公室布线，可以采用这种方式。  

### 非导引型传输媒体  
我们可以利用电磁波在自由空间的传播来传输信息  

**无线电波和微波：**  

这是电信领域使用的电磁波的频谱  
![p2_mei_ti_8]()  
这是国际电信联盟ITU对电磁频段的划分：  
![p2_mei_ti_9]()  
![p2_mei_ti_10]()   
从低频谱到甚高频，这些频段的电磁波又称为无线电波，用于国际广播，海事，电台广播，电视广播等。  

从特高频到极高频，这些频段的电磁波又称为微波，用于无线电话，无线网络，雷达，人体扫描等  

无线电波中的低频(LF)和中频(MF)段，主要利用地面波进行传输：  
![p2_mei_ti_11]()  
无线电波中的高频(HF)和甚高频段，主要是靠电离层的反射  
![p2_mei_ti_12]()  

微波在空间中主要是直线传播，由于微波会穿透电离层进入宇宙空间，因此它不能经过电离层的反射传播到地面上很远的地方。  
传统的微波通信主要有两种方式：  
- 地面微波接力通信
- 微信通信  

由于微波是直线传播的，而地球表面是一个曲面，因此其传播距受到限制，一般只有50公里左右，但若采用100米高的天线塔，则传播距离可增大到100公里。为实现远距离通信，必须一条微波通信信道的两个终端之间建立若干个中继站，中继站把前一站送来的信号经过放大后再发送到下一站，故称为“接力”。   
![p2_mei_ti_13]()  

常用的卫星通信方法是在地球站之间，利用位于3万6千公里高空的人造同步地球卫星作为中继器的一种微波接力通信，其最大特点是通信距离远，相应的，传播时延也比较大，一般在250~300ms之间。除同步卫星外，低轨道卫星通信系统已开始在空间部署，并构成了空间高速链路。  
![p2_mei_ti_14]() ![p2_mei_ti_15]()  

**红外线传输数据**  
很多家用电器，如电视，空调都配有红外遥控器。  
红外线传输属于点对点通信，中间不能有障碍物，传输距离短，传输速率低(4Mb/s~16Mb/s)  

**可见光通信**  
[可见光通信视频](https://v.qq.com/x/page/o0181rzwirc.html)  

要使用某一段无线频谱进行通信，通常必须得到本国政府有关无线电频谱管理机构的认证。我国的无线电频谱管理机构是工信部无线电管理局，美国的无线电频谱管理机构是联邦通讯委员会FCC，也有一些无线点频段是可以自由使用的，称为ISM频段，也就是工业，科学，医疗频段。  
这是美国的ISM频段：  
![p2_mei_ti_16]()  
现在的无线局域网就使用其中的2.4GHZ和5.8GHZ频段，各国的ISM标准可能略有不同。 
## <a name="3">传输方式</a>  
**串行传输和并行传输**  
串行传输是指数据是一个比特一个比特依次发送的，因此在发送端和接收端之间，只需要一条数据传输线路即可  
![p2_chuan_shu_1]()  

并行传输是指一次发送n个比特而不是一个比特，为此，在发送端和接收端之间需要有n条传输线路  
![p2_chuan_shu_2]()  

并行传输的优点是速度是串行传输的n倍，但也存在一个严重的缺点，即成本高  

在计算机内部常常采用的是并行传输的方式，例如，CPU与内存之间，通过总线进行数据传输，常见的数据总线宽度有8位，16位，32位和64位，而在计算机网络中常常采用的是串行传输。  

**同步传输和异步传输**  
同步传输：采用同步传输方式，数据块以稳定的比特流的形式传输，字节之间没有间隔，接收端在每个比特信号的中间时刻进行检测，以判别接收到的是比特0还是比特1。  
![p2_chuan_shu_3]()  
由于不同机器的时钟频率存在差异，不可能做到完全相同，在传输大量数据的过程中，所产生的判别时刻的累计误差会导致接收端对比特信号的判别错位，因此需要采取方法使收发双方的时钟保持同步   

实现收发双方时钟同步的方法主要有两种：
- 外同步：在收发双方之间添加一条单独的时钟信号线，发送方在发送数据的同时再发送一路时钟信号，接收端按照时钟同步信号的节奏来接收数据  
- 内同步：发送端将时钟同步信号编码到发送数据中一起传输(例如[曼彻斯特编码](https://baike.baidu.com/item/%E6%9B%BC%E5%BD%BB%E6%96%AF%E7%89%B9%E7%BC%96%E7%A0%81/8902319?fr=aladdin)) 传统以太网采用的就是曼彻斯特编码  

异步传输：
采用异步传输方式时，以字节为独立的传输单位，字节之间的时间间隔不是固定的，接收端只在每个字节的起始处对字节内的比特实现同步  
![p2_chuan_shu_4]()  
为此，通常要在每个字节前后分别加上初始位和结束位，这里的异步是指字节之间异步，也就是字节之间的时间间隔不固定，但字节中的每个比特仍然要保持同步，也就是各比特的持续时间是相同的  

**单工、半双工、全双工**  
单工通信：单工通信又称为单向通信，通信双方只有一个数据传输方向。例如，无线电广播采用的就是这种通信方式  
![p2_chuan_shu_5]()  

半双工通信：又称为双向交替通信，通信双方可以相互传输数据，但不能同时进行。例如，对讲机采用的就是这种通信方式  
![p2_chuan_shu_6]()   

全双工通信:又称为双向同时通信，通信双方可以同时发送和接收信息。例如，电话采用的就是这种通信方式  
![p2_chuan_shu_7]()  

单向通信只需要一条信道，而双向交替通信或双向同时通信则都需要两条信道(每个方向各一条)  
## <a name="4">编码与调制</a>  
在计算机网络中，计算机需要处理和传输用户的文字，图片，音频和视频，它们可以统称为消息，数据是运送消息的实体，我们熟悉的是十进制数据，而计算机只能处理二进制数据，也就是比特0和1。计算机中的网卡将比特0和比特1变换成相应的电信号发送到网线，也就是说，信号是数据的电磁表现。  
![p2_chuan_shu_8]()  

由信源发出的原始电信号称为基带信号，基带信号又可分为两类:  
一类是数字基带信号，例如，计算机内部CPU与内存之间出传输的信号。  
另一类是模拟基带信号，例如，麦克风收到声音后产生的音频信号。

信号需要在信道中进行传输，信道可分为数字信道和模拟信道两种。在不改变信号性质的前提下，仅对数字基带信号的波形进行变换，称为编码。编码后产生的数字信号仍为数字信号，可以在数字信道中传输，例如，以太网使用曼彻斯特编码，4B/5B、8B/10B等编码。  

把数字基带信号的频率范围搬移到较高的频段并转换为模拟信号，称为调制。调制后产生的信号是模拟信号，可以在模拟信道中传输，例如，WIFI使用补码键控、直接序列扩频、正交频复用等调制方法。  

对于模拟基带信号的处理，也有编码和调制两种方法。对模拟基带信号进行编码的典型处理是对音频信号进行编码的脉冲调制PCM，也就是将模拟音频信号，通过采样，量化，编码三个步骤进行数字化。

对模拟信号进行调制的典型应用是将语音数据加载到模拟的载波信号中传输，例如传统的电话，另一个是频分复用FDM技术，可以充分利用带宽资源。  

接下来，我们介绍码元的概念，在使用时间域的波形表示数字信号时，**代表不同离散数值的基本波形称为码元**，简单来说，码元就是构成信号的一段波形，例如，下面是一个调频信号,绿色部分波形是构成该信号的一个基本波形,它可以表示比特0或1。蓝色部分波形是构成该信号的另一个基本波形，它可以表示比特0或1，我们可以称它们为码元。可见，该信号由两种码元构成   
![p2_chuan_shu_9]()  
传输媒体与信道之间的关系：  
严格来说，两者并不相等。对于单工传输，传输媒体中只包含一个信道，要么是发送信道，要么是接收信道。而对于半双工和全双工传输，传输媒体中包含两条信道，一个是发送信道，另一个是接收信道。如果使用信道复用技术，一条传输媒体还可以包含多个信道。在计算机网络中，常见的是将数字基带信号通过编码或调制的方法在相应信道进行传输。   
![p2_chuan_shu_10]() 

下面我们介绍几种常用编码：  
以下面待传输的比特流为例  
![p2_chuan_shu_11]()  
**不归零编码：**  
这是采用不归零编码产生的该比特流的相应信号,正电平表示比特1，负电平表示0，所谓不归零，就是指在整个码元时间内，电平不会出现零电平，为了准确的区分不同的码元，需要保持接收端和发送端的时钟同步，这就需要额外一根传输线来传输时钟信号，接收方按照时钟信号的节拍来逐个接收码元，然而，对于计算机网络，宁愿用这根传输线来传输数据信号，而不是传输时钟信号，因此，由于不归零编码存在同步问题，计算机网络中的数据传输不采用这类编码。  
![p2_chuan_shu_12]()  

**归零编码**  
下面是采用归零编码产生的该比特流的相应信号。很明显，每个码元传输结束后信号都要"归零"。所以接收方只要在信号归零后进行采样即可，不需要单独的时钟信号。实际上，归零编码相当于把时钟信号用"归零"方式编码在了数据之内，这称为"自同步"信号，但是，归零编码中大部分的数据带宽都用来传输归零信号而浪费掉了。也就是说归零编码的优点是自同步，但缺点是编码效率低。  
![p2_chuan_shu_13]()  

**曼彻斯特编码**  
下面是曼彻斯特编码产生的该比特流的相应信号。在每个码元的中间时刻，信号都会发生跳变，例如负跳变表示比特1，正跳变表示比特0。码元中间时刻的跳变既表示时钟，又表示数据，传统以太网采用的就是曼彻斯特编码。  
![p2_chuan_shu_14]()  

**差分曼彻斯特编码**  
下面是差分曼彻斯特编码产生的该比特流的相应信号。在每个码元的中间时刻，信号都会发生跳变。与曼彻斯特编码不同，跳变仅表示时钟，而用码元开始处电平是否发生变化来表示数据。   
![p2_chuan_shu_15]()   

下面我们介绍几种基本调制方法：  
这是待传输的数字基带信号，也就是来自信源的原始数字信号，我们要用模拟信道来传输，因此需要将数字基带信号通过调制方法，调制成可以在模拟信道中传输的模拟信号  
![p2_chuan_shu_16]()  
这是调幅所产生的模拟信号,无载波输出表示比特0，有载波输出表示比特1.  
![p2_chuan_shu_17]()  
这是调频所产生的模拟信号，频率f1的波形表示比特0，频率f2的波形表示比特1  
![p2_chuan_shu_18]()  
这是调相所产生的模拟信号，初相位0度的波形表示比特0，初相位180度的波形表示比特1  
![p2_chuan_shu_19]()  

使用基本调制方法，1个码元只能包含一个比特信息，如何能使1个码元包含更多的比特呢，可以采用混合调制的方法，因为频率和相位是相关的，即频率是相位随时间的变化率，所以一次只能调制频率和相位两个中的一个。通常情况下，相位和振幅可以结合起来一起调制，称为**正交振幅调制QAM**。  

## <a name="5">信道的极限容量</a>  
信号在传输过程中会受到各种因素的影响。  
这是一个数字信号，当它通过实际的信道后，波形会产生失真，当失真不严重时，在输出端还可还原出发送的码元。但当失真严重时，在输出端就很难判断这个信号在什么时候是1和在什么时候是0.信号波形失去了码元之间的清晰界限，这种现象叫做"**码间串扰**"  

产生失真的因素主要有：  
- 信号传输距离  
- 噪声干扰  
- 传输媒体质量

早在1924年，奈奎斯特就推导出了著名的**奈氏准则**：  
在假定的理想条件下，**为了避免码间串扰，码元传输速率 是有上限的**  
理想低通道的最高码元传输速率 = 2W Baud = 2W 码元/秒  
理想带通信道的最高码元传输速率 = W Baud = W 码元/秒  
W：信道带宽(单位为HZ)  
Baud:波特，即，码元/秒  
码元传输速率又称为波特率、调制速率、波形速率或符号速率。它与比特率有一定关系：  
- 当一个码元只携带1比特信息时，则波特率(码元/秒)与比特率(比特/秒)在数值上是相等的
- 当1个码元携带n比特信息量时，则波特率转换成比特率时，数值要乘以n      

要提高信息传输速率，就必须设法使每一个码元能携带更多个比特的信息量。这需要采用多元制。  
实际的信道所能传输的最高码元速率，要明显低于奈氏准则给出的这个上限数值。

即使采用更好的调制方法，让码元可以携带更多的比特，也不能无限制的提高信息的传输速率，因为信道的传输速率还要受限于实际的信号在信道中传输时的信噪比。  


**香农公式**  
想农公式给出了带宽受限且有高斯白噪声干扰的信道的极限信息传输速率  
![p2_ji_xian_1]()  
c:信道的极限信息传输速率(单位：b/s)  
W:信道带宽(单位：HZ)  
S:信道内所传信号的平均功率  
N：信道内的高斯噪声功率  
S/N:信噪比，使用分贝(dB)作为度量单位  

从香农公式中可以看出：
- 信道带宽或信道中信噪比越大，信息的极限传输速率越高。
- 在实际信道上能达到的信息传输速率要比该公式的极限传输速率低不少。这是因为在实际信道中，信号还要受到其他一些损伤，如脉冲干扰，信号在传输中的衰减和失真等，这些因素在香农公式中并未考虑。

在信道带宽一定的情况下，根据奈奎斯特准则和香农公式，要想**提高信息的传输速率**就必须采用**多元制**和努力**提高信道中的信噪比**  

自从香农公式发表后，各种**新的信号处理和调制方法就不断出现**，其目的都是为了尽可能地**接近香农公式给出的传输速率极限。**







